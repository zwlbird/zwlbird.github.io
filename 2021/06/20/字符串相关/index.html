<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>字符串相关 | .oOo.</title><meta name="keywords" content="Qt,C++"><meta name="author" content="Smt"><meta name="copyright" content="Smt"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="字符串查找find123456789101112131415161718size_t find ( const string&amp; str, size_t pos &#x3D; 0 ) const;size_t find ( const char* s, size_t pos, size_t n ) const;size_t find ( const char* s, size_t pos &#x3D; 0 )">
<meta property="og:type" content="article">
<meta property="og:title" content="字符串相关">
<meta property="og:url" content="https://zwlbird.github.io/2021/06/20/%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%9B%B8%E5%85%B3/index.html">
<meta property="og:site_name" content=".oOo.">
<meta property="og:description" content="字符串查找find123456789101112131415161718size_t find ( const string&amp; str, size_t pos &#x3D; 0 ) const;size_t find ( const char* s, size_t pos, size_t n ) const;size_t find ( const char* s, size_t pos &#x3D; 0 )">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://i.loli.net/2021/06/27/W8xTBGA2O7JhRHl.jpg">
<meta property="article:published_time" content="2021-06-20T09:23:42.000Z">
<meta property="article:modified_time" content="2024-01-05T09:55:39.886Z">
<meta property="article:author" content="Smt">
<meta property="article:tag" content="Qt">
<meta property="article:tag" content="C++">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://i.loli.net/2021/06/27/W8xTBGA2O7JhRHl.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://zwlbird.github.io/2021/06/20/%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%9B%B8%E5%85%B3/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: true,
    post: true
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#121212","position":"bottom-left"},
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '字符串相关',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-01-05 17:55:39'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const fontSizeVal = saveToLocal.get('global-font-size')
    if (fontSizeVal !== undefined) {
      document.documentElement.style.setProperty('--global-font-size', fontSizeVal + 'px')
    }
    })(window)</script><meta name="generator" content="Hexo 5.4.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="author-avatar"><img class="avatar-img" src="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">26</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">标签</div><div class="length-num">6</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">分类</div><div class="length-num">14</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fas fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 娱乐</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> Movie</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 链接</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://i.loli.net/2021/06/27/W8xTBGA2O7JhRHl.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">.oOo.</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fas fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 娱乐</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> Movie</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 链接</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">字符串相关</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2021-06-20T09:23:42.000Z" title="发表于 2021-06-20 17:23:42">2021-06-20</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-01-05T09:55:39.886Z" title="更新于 2024-01-05 17:55:39">2024-01-05</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%AD%97%E7%AC%A6%E4%B8%B2/">字符串</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">7.2k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>30分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="字符串相关"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-separator">|</span><span class="post-meta-commentcount"><i class="far fa-comments fa-fw post-meta-icon"></i><span class="post-meta-label">评论数:</span><a href="/2021/06/20/%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%9B%B8%E5%85%B3/#post-comment" itemprop="discussionUrl"><span class="valine-comment-count" data-xid="/2021/06/20/%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%9B%B8%E5%85%B3/" itemprop="commentCount"></span></a></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="字符串查找"><a href="#字符串查找" class="headerlink" title="字符串查找"></a>字符串查找</h1><h2 id="find"><a href="#find" class="headerlink" title="find"></a>find</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">size_t</span> <span class="title">find</span> <span class="params">( <span class="keyword">const</span> string&amp; str, <span class="keyword">size_t</span> pos = <span class="number">0</span> )</span> <span class="keyword">const</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">size_t</span> <span class="title">find</span> <span class="params">( <span class="keyword">const</span> <span class="keyword">char</span>* s, <span class="keyword">size_t</span> pos, <span class="keyword">size_t</span> n )</span> <span class="keyword">const</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">size_t</span> <span class="title">find</span> <span class="params">( <span class="keyword">const</span> <span class="keyword">char</span>* s, <span class="keyword">size_t</span> pos = <span class="number">0</span> )</span> <span class="keyword">const</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">size_t</span> <span class="title">find</span> <span class="params">( <span class="keyword">char</span> c, <span class="keyword">size_t</span> pos = <span class="number">0</span> )</span> <span class="keyword">const</span></span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">参数说明：pos查找起始位置 n待查找字符串的前n个字符</span><br><span class="line">使用样例：</span><br><span class="line"><span class="function">string <span class="title">str1</span><span class="params">(<span class="string">&quot;the usage of find can you use it&quot;</span>)</span></span>;</span><br><span class="line"><span class="function">string <span class="title">str2</span><span class="params">(<span class="string">&quot;the&quot;</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">上面定义出了两个字符串；</span><br><span class="line">str1.<span class="built_in">find</span>(str2); <span class="comment">// 从串str1中查找时str2，返回str2中首个字符在str1中的地址</span></span><br><span class="line">str1.<span class="built_in">find</span>(str2,<span class="number">5</span>); <span class="comment">// 从str1的第5个字符开始查找str2</span></span><br><span class="line">str1.<span class="built_in">find</span>(<span class="string">&quot;usage&quot;</span>); <span class="comment">// 如果usage在str1中查找到，返回u在str1中的位置</span></span><br><span class="line">str1.<span class="built_in">find</span>(<span class="string">&quot;o&quot;</span>); <span class="comment">// 查找字符o并返回地址</span></span><br><span class="line">str1.<span class="built_in">find</span>(<span class="string">&quot;of big&quot;</span>,<span class="number">2</span>,<span class="number">2</span>); <span class="comment">// 从str1中的第二个字符开始查找of big的前两个字符</span></span><br></pre></td></tr></table></figure>

<h2 id="find-first-of"><a href="#find-first-of" class="headerlink" title="find_first_of"></a>find_first_of</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">size_t</span> <span class="title">find_first_of</span> <span class="params">( <span class="keyword">const</span> string&amp; str, <span class="keyword">size_t</span> pos = <span class="number">0</span> )</span> <span class="keyword">const</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">size_t</span> <span class="title">find_first_of</span> <span class="params">( <span class="keyword">const</span> <span class="keyword">char</span>* s, <span class="keyword">size_t</span> pos, <span class="keyword">size_t</span> n )</span> <span class="keyword">const</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">size_t</span> <span class="title">find_first_of</span> <span class="params">( <span class="keyword">const</span> <span class="keyword">char</span>* s, <span class="keyword">size_t</span> pos = <span class="number">0</span> )</span> <span class="keyword">const</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">size_t</span> <span class="title">find_first_of</span> <span class="params">( <span class="keyword">char</span> c, <span class="keyword">size_t</span> pos = <span class="number">0</span> )</span> <span class="keyword">const</span></span>;</span><br><span class="line">参数和find基本相同，不在赘述!</span><br><span class="line">特别注意：</span><br><span class="line">find_first_of 函数最容易出错的地方是和find函数搞混。它最大的区别就是如果在一个字符串str1中查找另一个字符串str2，如果str1中含有str2中的任何字符，则就会查找成功，而find则不同；</span><br><span class="line"></span><br><span class="line">比如：</span><br><span class="line"><span class="function">string <span class="title">str1</span><span class="params">(<span class="string">&quot;I am change&quot;</span>)</span></span>;</span><br><span class="line"><span class="function">string <span class="title">str2</span><span class="params">(<span class="string">&quot;about&quot;</span>)</span></span>;</span><br><span class="line"><span class="keyword">int</span> k=str1.<span class="built_in">find_first_of</span>(str2); <span class="comment">//k返回的值是about这5个字符中任何一个首次在str1中出现的位置；</span></span><br></pre></td></tr></table></figure>

<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">string <span class="title">Cfg::valS</span><span class="params">(string paramName)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ifstream infile;</span><br><span class="line">    infile.<span class="built_in">open</span>(m_configPath);</span><br><span class="line">    string str;</span><br><span class="line">    <span class="keyword">while</span> (<span class="built_in">getline</span>(infile, str))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//剔除注释</span></span><br><span class="line">        <span class="keyword">int</span> posCom = str.<span class="built_in">find_first_of</span>(<span class="string">&#x27;#&#x27;</span>, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">if</span> (posCom != string::npos)str.<span class="built_in">erase</span>(posCom);</span><br><span class="line">        <span class="keyword">if</span> (str.<span class="built_in">empty</span>()) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="comment">//截取参数名</span></span><br><span class="line">        <span class="keyword">int</span> pos = str.<span class="built_in">find_first_of</span>(<span class="string">&#x27;=&#x27;</span>, <span class="number">0</span>);</span><br><span class="line">        string param = str.<span class="built_in">substr</span>(<span class="number">0</span>, pos);</span><br><span class="line">        <span class="comment">//剔除字符串前后多余空格</span></span><br><span class="line">        param.<span class="built_in">erase</span>(<span class="number">0</span>, param.<span class="built_in">find_first_not_of</span>(<span class="string">&quot; &quot;</span>));</span><br><span class="line">        param.<span class="built_in">erase</span>(param.<span class="built_in">find_last_not_of</span>(<span class="string">&quot; &quot;</span>) + <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">if</span> (param == paramName)</span><br><span class="line">        &#123;</span><br><span class="line">            infile.<span class="built_in">close</span>();</span><br><span class="line">            string value = str.<span class="built_in">substr</span>(pos + <span class="number">1</span>, str.<span class="built_in">length</span>() - pos);</span><br><span class="line">            <span class="comment">//剔除字符串前后多余空格</span></span><br><span class="line">            value.<span class="built_in">erase</span>(<span class="number">0</span>, value.<span class="built_in">find_first_not_of</span>(<span class="string">&quot; &quot;</span>));</span><br><span class="line">            value.<span class="built_in">erase</span>(value.<span class="built_in">find_last_not_of</span>(<span class="string">&quot; &quot;</span>) + <span class="number">1</span>);</span><br><span class="line">            <span class="keyword">return</span> value;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    infile.<span class="built_in">close</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="find-last-of"><a href="#find-last-of" class="headerlink" title="find_last_of"></a>find_last_of</h2><p>用法：str.find_last_of(str1,pos)</p>
<p>说明：从pos位置开始查找，从后往前，查到str1中的任何一个字符则返回其str中的索引值</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">string <span class="title">reverseVowels</span><span class="params">(string s)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> left=<span class="number">0</span>,right=s.<span class="built_in">size</span>()<span class="number">-1</span>;</span><br><span class="line">        <span class="keyword">while</span>(left&lt;right)</span><br><span class="line">        &#123;</span><br><span class="line">            left=s.<span class="built_in">find_first_of</span>(<span class="string">&quot;aeiouAEIOU&quot;</span>,left);</span><br><span class="line">            right=s.<span class="built_in">find_last_of</span>(<span class="string">&quot;aeiouAEIOU&quot;</span>,right);</span><br><span class="line">            <span class="keyword">if</span>(left&lt;right)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="built_in">swap</span>(s[left++],s[right--]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> s;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h1 id="字符串分割"><a href="#字符串分割" class="headerlink" title="字符串分割"></a>字符串分割</h1><h2 id="substr"><a href="#substr" class="headerlink" title="substr"></a>substr</h2><p><strong>basic_string::substr</strong></p>
<p>basic_string substr(<a target="_blank" rel="noopener" href="https://baike.so.com/doc/6847447-7064872.html">size_type</a> _Off = 0,size_type _Count = npos) const;</p>
<p>参数</p>
<p>_Off        所需的子字符串的起始位置。<a target="_blank" rel="noopener" href="https://baike.so.com/doc/2529629-2672477.html">字符</a>串中第一个字符的索引为 0,默认值为0.</p>
<p>_Count   复制的字符数目</p>
<p>返回值    一个子字符串，从其指定的位置开始</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">std::vector&lt;std::string&gt; <span class="title">splitWithStl</span><span class="params">(<span class="keyword">const</span> std::string &amp;str,<span class="keyword">const</span> std::string &amp;pattern)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::vector&lt;std::string&gt; resVec;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="string">&quot;&quot;</span> == str)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> resVec;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//方便截取最后一段数据</span></span><br><span class="line">    std::string strs = str + pattern;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">size_t</span> pos = strs.<span class="built_in">find</span>(pattern);</span><br><span class="line">    <span class="keyword">size_t</span> size = strs.<span class="built_in">size</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (pos != std::string::npos)</span><br><span class="line">    &#123;</span><br><span class="line">        std::string x = strs.<span class="built_in">substr</span>(<span class="number">0</span>,pos);</span><br><span class="line">        resVec.<span class="built_in">push_back</span>(x);</span><br><span class="line">        strs = strs.<span class="built_in">substr</span>(pos+<span class="number">1</span>,size);</span><br><span class="line">        pos = strs.<span class="built_in">find</span>(pattern);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> resVec;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="strtok"><a href="#strtok" class="headerlink" title="strtok()"></a>strtok()</h2><p><em><strong>原型</strong></em>：char *strtok(char *str, const char *delim);<br>功能：分解字符串为一组字符串。s为要分解的字符串，delim为分隔符字符串。<br><em><strong>描述</strong></em>：strtok()用来将字符串分割成一个个片段。参数s指向欲分割的字符串，参数delim则为分割字符串，当strtok()在参数s的字符串中发现到参数delim的分割字符时 则会将该字符改为\0 字符。在第一次调用时，strtok()必需给予参数s字符串，往后的调用则将参数s设置成NULL。每次调用成功则返回被分割出片段的指针。</p>
<p>其它：strtok函数线程不安全，可以使用strtok_r替代。 </p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">vector&lt;string&gt; <span class="title">split</span><span class="params">(<span class="keyword">const</span> string &amp;str,<span class="keyword">const</span> string &amp;pattern)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//const char* convert to char*</span></span><br><span class="line">    <span class="keyword">char</span> * strc = <span class="keyword">new</span> <span class="keyword">char</span>[<span class="built_in">strlen</span>(str.<span class="built_in">c_str</span>())+<span class="number">1</span>];</span><br><span class="line">    <span class="built_in">strcpy</span>(strc, str.<span class="built_in">c_str</span>());</span><br><span class="line">    vector&lt;string&gt; resultVec;</span><br><span class="line">    <span class="keyword">char</span>* tmpStr = <span class="built_in">strtok</span>(strc, pattern.<span class="built_in">c_str</span>());</span><br><span class="line">    <span class="keyword">while</span> (tmpStr != <span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        resultVec.<span class="built_in">push_back</span>(<span class="built_in">string</span>(tmpStr));</span><br><span class="line">        tmpStr = <span class="built_in">strtok</span>(<span class="literal">NULL</span>, pattern.<span class="built_in">c_str</span>());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">delete</span>[] strc;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> resultVec;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">char</span> *p = <span class="built_in">strtok</span>((<span class="keyword">char</span> *)str.<span class="built_in">data</span>(), <span class="string">&quot;,&quot;</span>);</span><br><span class="line"><span class="keyword">while</span> (p) &#123;</span><br><span class="line">    string s = p; <span class="comment">//分割得到的字符串转换为string类型  </span></span><br><span class="line">    timerange.<span class="built_in">push_back</span>(s); <span class="comment">//存入结果数组  </span></span><br><span class="line">    p = <span class="built_in">strtok</span>(<span class="literal">NULL</span>, <span class="string">&quot;,&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="C-宽字符处理函数-与-普通函数-对照表"><a href="#C-宽字符处理函数-与-普通函数-对照表" class="headerlink" title="C++宽字符处理函数 与 普通函数 对照表"></a>C++宽字符处理函数 与 普通函数 对照表</h1><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">字符串操作： </span><br><span class="line">宽字符函数         普通C函数                       描述</span><br><span class="line"><span class="built_in">wcscat</span>()        <span class="built_in">strcat</span>()                            把一个字符串接到另一个字符串的尾部 </span><br><span class="line"><span class="built_in">wcsncat</span>()      <span class="built_in">strncat</span>()                          类似于<span class="built_in">wcscat</span>()， 而且指定粘接字符串的粘接长度. </span><br><span class="line"><span class="built_in">wcschr</span>()        <span class="built_in">strchr</span>()                            查找子字符串的第一个位置 </span><br><span class="line"><span class="built_in">wcsrchr</span>()       <span class="built_in">strrchr</span>()                          从尾部开始查找子字符串出现的第一个位置 </span><br><span class="line"><span class="built_in">wcspbrk</span>()      <span class="built_in">strpbrk</span>()                         从一字符字符串中查找另一字符串中任何一个字符第一次出现的位置 </span><br><span class="line"><span class="built_in">wcswcs</span>()       /<span class="built_in">wcsstr</span>()        <span class="built_in">strchr</span>()      在一字符串中查找另一字符串第一次出现的位置 </span><br><span class="line"><span class="built_in">wcscspn</span>()      <span class="built_in">strcspn</span>()                        返回不包含第二个字符串的的初始数目 </span><br><span class="line"><span class="built_in">wcsspn</span>()        <span class="built_in">strspn</span>()                         返回包含第二个字符串的初始数目 </span><br><span class="line"><span class="built_in">wcscpy</span>()        <span class="built_in">strcpy</span>()                          拷贝字符串 </span><br><span class="line"><span class="built_in">wcsncpy</span>()      <span class="built_in">strncpy</span>()                        类似于<span class="built_in">wcscpy</span>()， 同时指定拷贝的数目 </span><br><span class="line"><span class="built_in">wcscmp</span>()       <span class="built_in">strcmp</span>()                         比较两个宽字符串 </span><br><span class="line"><span class="built_in">wcsncmp</span>()     <span class="built_in">strncmp</span>()                       类似于<span class="built_in">wcscmp</span>()， 还要指定比较字符字符串的数目 </span><br><span class="line"><span class="built_in">wcslen</span>()        <span class="built_in">strlen</span>()                           获得宽字符串的数目 </span><br><span class="line"><span class="built_in">wcstok</span>()        <span class="built_in">strtok</span>()                          根据标示符把宽字符串分解成一系列字符串 </span><br><span class="line"><span class="built_in">wcswidth</span>()     None                             获得宽字符串的宽度 </span><br><span class="line"><span class="built_in">wcwidth</span>()       None                              获得宽字符的宽度 </span><br><span class="line"></span><br><span class="line">另外还有对应于memory操作 的 <span class="built_in">wmemcpy</span>()， <span class="built_in">wmemchr</span>()， <span class="built_in">wmemcmp</span>()， <span class="built_in">wmemmove</span>()， <span class="built_in">wmemset</span>()．</span><br></pre></td></tr></table></figure>

<h1 id="宽字符"><a href="#宽字符" class="headerlink" title="宽字符"></a>宽字符</h1><p><img src="/2021/06/20/%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%9B%B8%E5%85%B3/11111.png" alt="img"><img src="/2021/06/20/%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%9B%B8%E5%85%B3/22222.png" alt="img"></p>
<p>ANSI和UTF8编码下显示结果不同，读入C++，使用窄字符读取不能识别‘？’</p>
<p>而且这个ANSI编码中的’?’，读在程序里ASCII码是-80，不是查表的63；</p>
<p>看UTF8编码中的十六进制显示是176，超过了【-128,127】，经过计算-128+（176-127）-1=-80；</p>
<p>后来使用宽字节读取后显示为汉字的‘°’，是宽字符，所以用窄字符显示的时候，ANSI显示不全。</p>
<h2 id="为什么会是负数"><a href="#为什么会是负数" class="headerlink" title="为什么会是负数"></a><a target="_blank" rel="noopener" href="https://blog.csdn.net/kelehaier/article/details/59560419" title="为什么会是负数">为什么会是负数</a></h2><p>最近两天在研究基于位运算的字符串模糊匹配时，在匹配过程中，因为中文的原因，出现了很多问题。最终发现了C++中有一个类型叫做wchar_t，宽字符，用于表示Unicode字符集，很好的解决了string和char在中文表示上的问题。以前没有引起足够的重视，现在在出现了很多问题后才不得不面对这个问题。</p>
<p>在我们常用的类型string和char中，对中文支持并不是很好。在这两种类型中，中文都是两个字节，也就是说中文的汉字要占用两个位置，举个简单的例子，一个“汉”字用一个char是无法表示的，即 char c = ‘汉’ ; 是错误的，必须用 char c[3] = “汉”. 汉字占用两个字节，还有一个结尾符“0/”。string s = “汉” ; s.length()的值是2.</p>
<p>通过以上描述，我们会发现，我们在进行包含中文字符串处理的过程中就会遇到以下问题：在包含数字，字母，汉字的字符串处理中我们应该怎样应付各个字符占多少个字节？总不能在处理之前先转换成ASCII码判断它属于哪种字符在进行处理吧？中文取两个，字母和数字取一个。在进行判断相等与否时也遇到了问题。</p>
<blockquote>
<p>\1. string s = “中国人”; 想知道第二个字是不是“国”字，不能够直接使用 “s[2] == “国””，这样的s[2]是指“国”字的前一个字节代表的数字，是个负数，两个根本无法相等。必须使用 strncmp(&amp;s[2], “国”, 2); 这个函数来进行匹配。这个函数的含义是对字符串进行比较，将从第一个参数位置开始的第三个参数个字符与第二个参数进行比较，如果相等则返回0，不相等就返回1.具体到本例中s[2]开始的2个字符与“国”字进行比较。在这用情况下，不仅增加了表达的复杂度，而且增加了算法的复杂度。</p>
<p>\2. 想进行匹配或者其他处理必须先判断类型，也就是要维护一个几乎和原字符串等长的类型链表，用于标记原字符串各个位置上的类型。在进行操作时，先判断类型，数字和字母等往后挪一位，汉字等往后挪两位，这样即麻烦又浪费存储空间。</p>
<p>\3. 不知者在进行匹配时，用过使用 s[i] == p[j] 时会产生意想不到的结果。我就是问题出在这里。用字母进行匹配时一点问题也没有，简单的几个汉字也没有问题，但是当我使用几万字的两个文本进行匹配时就产生了很大的问题。每个汉字会被拆成两个负整数来表示，假设一个汉字被拆成了-3444，-1235，另外一个被拆成了-6433，-1235，那么本来毫无关系的两个汉字就会错误的被认为成第二个是相等的，最终的结果就会产生错误。</p>
</blockquote>
<p>wchar_t 和 wstring的出现很好的解决了这些问题。</p>
<p>wchar_t c = ‘汉’; 不会出现任何问题。对应的字符串则为wstring。在这两个类型中，默认的情况下字母和数字就占用1个字节，而汉字汉用2个字节，能够很好的解决上面提到的三个问题。如：wstring s = “中国人abc” ; s.length() 的值是6，在string类型下值是9，这基本就是wstring和string的差别。</p>
<p>针对wstring有对应的fopen方法。对于Unicode的文件，使用下面方式读取文件，与默认的不太一样。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">FILE* fp;</span><br><span class="line"><span class="keyword">wchar_t</span> utf[<span class="number">20000</span>], *p = utf;</span><br><span class="line">fp = _wfopen(name.<span class="built_in">c_str</span>(), <span class="string">L&quot;rb&quot;</span>);</span><br><span class="line"><span class="keyword">while</span>(!<span class="built_in">feof</span>(fp))</span><br><span class="line"><span class="built_in">fread</span>(p++, <span class="number">1</span>, <span class="number">2</span>, fp);</span><br><span class="line">*--p = <span class="string">L&#x27;\0&#x27;</span>;</span><br><span class="line"><span class="built_in">fclose</span>(fp);[/color]</span><br></pre></td></tr></table></figure>

<p>在宽字符指针p中就存储了文本中的内容。但是记住，一定要是Unicode的编码，如果是其他编码的文本，则会出现乱码。<br>string和char对应的读取字符串的方法如下：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">FILE* fp = <span class="built_in">fopen</span>(tStr.<span class="built_in">c_str</span>(),rb);</span><br><span class="line"><span class="keyword">if</span> (fp == <span class="literal">NULL</span>)</span><br><span class="line">&#123;</span><br><span class="line">cout&lt;&lt;<span class="string">&quot;failed to read&quot;</span>;</span><br><span class="line"><span class="built_in">getchar</span>();</span><br><span class="line"><span class="keyword">return</span> a;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">fseek</span>(fp, <span class="number">0</span>, SEEK_END);</span><br><span class="line"><span class="keyword">int</span> len = <span class="built_in">ftell</span>(fp);</span><br><span class="line">cout&lt;&lt;len&lt;&lt;endl;</span><br><span class="line"><span class="built_in">rewind</span>(fp);</span><br><span class="line"><span class="keyword">char</span>* pBuffer = <span class="keyword">new</span> <span class="keyword">char</span>[len+<span class="number">1</span>];</span><br><span class="line"><span class="built_in">memset</span>(pBuffer, <span class="number">0</span>, len+<span class="number">1</span>);</span><br><span class="line"><span class="built_in">fread</span>(pBuffer, <span class="number">1</span>, len, fp);</span><br><span class="line"><span class="built_in">fclose</span>(fp);</span><br></pre></td></tr></table></figure>

<p>这样对应文本中的内容就会存在pBuffer中了。另外不能够用方法二只是稍微改动一下，即将char改为wchar_t，string改为wstring，fopen改为_wfopen，就去处理宽字符串，这样是不行的，会在正确文本的结尾产生大量乱码，估计是由于计算 len 的过程中中文按照两个长度算的，导致最后多了很多字符，成为乱码。</p>
<p>最后，记录一下宽字符和字符之间的转换。宽字符和字符实际上是统一的，两个之间只是所使用的字符集不同而已，以下两个函数能够比较理想的实现两者的转化：</p>
<h2 id="将普通字符串转化成宽字符："><a href="#将普通字符串转化成宽字符：" class="headerlink" title="将普通字符串转化成宽字符："></a>将普通字符串转化成宽字符：</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="keyword">char</span> *pFilePathName = <span class="string">&quot;c:\\aa.dll&quot;</span>; </span><br><span class="line"><span class="keyword">int</span> nLen = <span class="built_in">strlen</span>(pFilePathName) + <span class="number">1</span>; </span><br><span class="line"><span class="keyword">int</span> nwLen = <span class="built_in">MultiByteToWideChar</span>(CP_ACP, <span class="number">0</span>, pFilePathName, nLen, <span class="literal">NULL</span>, <span class="number">0</span>); </span><br><span class="line"><span class="keyword">wchar_t</span> lpszFile[<span class="number">256</span>]; </span><br><span class="line"><span class="built_in">MultiByteToWideChar</span>(CP_ACP, <span class="number">0</span>, pFilePathName, nLen, lpszFile, nwLen); </span><br></pre></td></tr></table></figure>

<p>最终的宽字符就存储在lpszFile里</p>
<h2 id="将宽字符转化成普通字符："><a href="#将宽字符转化成普通字符：" class="headerlink" title="将宽字符转化成普通字符："></a>将宽字符转化成普通字符：</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">int bytes = ::WideCharToMultiByte(CP_ACP, 0, tim.c_str(), tim.size(), NULL, 0, NULL, NULL);</span><br><span class="line">std::string strCmd;</span><br><span class="line">strCmd.resize(bytes);</span><br><span class="line">bytes= ::WideCharToMultiByte(CP_ACP, 0, tim.c_str(), tim.size(), const_cast&lt;char*&gt;(strCmd.data()), strCmd.size(), NULL, NULL);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>最终的普通字符就存储在strCmd里</p>
<h1 id="显示ascii码为负数"><a href="#显示ascii码为负数" class="headerlink" title="显示ascii码为负数??"></a>显示ascii码为负数??</h1><p><img src="/2021/06/20/%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%9B%B8%E5%85%B3/ba176e0a-9b4d-4668-9561-143ceefe9347.png" alt="img"></p>
<p><img src="/2021/06/20/%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%9B%B8%E5%85%B3/b3c89c34-662a-4c52-bb45-184166fcfa38.png" alt="img"></p>
<h1 id="swscanf-s"><a href="#swscanf-s" class="headerlink" title="swscanf_s"></a>swscanf_s</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">swscanf_s(timeStamp.c_str(), L&quot;%d-%d-%d %d:%d:%d&quot;,</span><br><span class="line">        &amp;tm.tm_mon, &amp;tm.tm_mday, &amp;tm.tm_year,</span><br><span class="line">        &amp;tm.tm_hour, &amp;tm.tm_min, &amp;tm.tm_sec);</span><br></pre></td></tr></table></figure>

<h1 id="strncpy-s"><a href="#strncpy-s" class="headerlink" title="strncpy_s"></a>strncpy_s</h1><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">char</span> g_command[<span class="number">20</span>];</span><br><span class="line"><span class="keyword">char</span> g_sendmessage[<span class="number">40</span>];<span class="comment">//接收下来的指令</span></span><br><span class="line"></span><br><span class="line">QByteArray ba = command.<span class="built_in">toLatin1</span>(); <span class="comment">// must</span></span><br><span class="line"><span class="built_in">strncpy_s</span>(g_sendbuf, <span class="number">20</span>, ba.<span class="built_in">data</span>(), command.<span class="built_in">length</span>());</span><br><span class="line"><span class="built_in">strncpy_s</span>(g_command, <span class="number">20</span>, ba.<span class="built_in">data</span>(), command.<span class="built_in">length</span>());</span><br><span class="line"></span><br><span class="line">ba = sendmessage.<span class="built_in">toLatin1</span>();</span><br><span class="line"><span class="built_in">strncpy_s</span>(g_sendmessage, <span class="number">40</span>, ba.<span class="built_in">data</span>(), sendmessage.<span class="built_in">length</span>());</span><br><span class="line"><span class="built_in">strncpy_s</span>(g_sendbuf + <span class="number">20</span>, <span class="number">40</span>, ba.<span class="built_in">data</span>(), sendmessage.<span class="built_in">length</span>());</span><br></pre></td></tr></table></figure>

<h1 id="sscanf-sprintf"><a href="#sscanf-sprintf" class="headerlink" title="sscanf  sprintf"></a>sscanf  sprintf</h1><p>输入：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sscanf</span>(str, <span class="string">&quot;%d,%d,%d,%d,%d,%lf&quot;</span>,</span><br><span class="line">            &amp;boat, &amp;xMin, &amp;yMin,</span><br><span class="line">            &amp;xMax, &amp;yMax, &amp;a);</span><br></pre></td></tr></table></figure>

<p>输出：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">string <span class="title">doubleToString</span><span class="params">(<span class="keyword">const</span> <span class="keyword">double</span> &amp;dbNum)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">char</span> *chCode;</span><br><span class="line">    chCode = <span class="built_in"><span class="keyword">new</span></span>(std::nothrow)<span class="keyword">char</span>[<span class="number">20</span>];</span><br><span class="line">    <span class="built_in">sprintf</span>(chCode, <span class="string">&quot;%.2lf&quot;</span>, dbNum);  <span class="comment">// .2 是控制输出bai精度的，两位小数</span></span><br><span class="line">    <span class="function">string <span class="title">strCode</span><span class="params">(chCode)</span></span>;</span><br><span class="line">    <span class="keyword">delete</span> []chCode;</span><br><span class="line">    <span class="keyword">return</span> strCode;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="数据转换-真实值、ASCII（理解的不对）"><a href="#数据转换-真实值、ASCII（理解的不对）" class="headerlink" title="数据转换-真实值、ASCII（理解的不对）"></a>数据转换-真实值、ASCII（理解的不对）</h1><p>socket发送数据，有两种方式：发送ascii码；发送真实数据。</p>
<p>第一种：发送ascii码（发送字符串，或者string.data()）</p>
<p>字符串里面就是一个一个ascii码追加起来的！</p>
<p>比如1234，要转成“1234”的字符串，然后用sendto或者send发出去，这样的话发送出去的数据就是’1’,’2’,’3’,’4’这样一个一个孤立的ascii码（或者说只要能把数字转换成这种形式（字符串）的函数也行，比如*_itoa<em>）,在收到之后按预留的对应位置取，或者用</em>sscanf*取，<img src="/2021/06/20/%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%9B%B8%E5%85%B3/bcf4a515-08cf-49c4-82f8-aa1fce3fc5b4.png" alt="img"></p>
<p>但是*_itoa<em>函数只能处理int，不能处理double和float，可以使用</em>sprintf()*代替，或者干脆简单点，直接弄成string，然后.data()就行了。</p>
<p><img src="/2021/06/20/%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%9B%B8%E5%85%B3/24e049ef-0dbd-40de-a9fe-c6ea36c2ebfa.png" alt="img"></p>
<p><strong>注意，</strong>这样的话发送的字节数和数值类型的字节数就不统一了，比如1234，应该是UINT16，即两个字节，这样转成string就需要4个字节，所以需要预留足够的位置，或者加分隔符。这样每个字节里面存的就是一个ascii码。</p>
<p>我们收到之后再memcpy取出来对应的字节数，然后强转成string，就得到“1234”这个字符串。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//发送测试</span></span><br><span class="line"><span class="keyword">float</span> _test = <span class="number">25.95</span>;</span><br><span class="line">string _str;</span><br><span class="line">_str = <span class="built_in">to_string</span>(_test) +<span class="string">&quot;,&quot;</span>+ <span class="built_in">to_string</span>(_test - <span class="number">10</span>);<span class="comment">//_str = &quot;25.950001,15.950001&quot;</span></span><br><span class="line"><span class="comment">//先拷贝在char * 里面，在转成float,字节数变了25.95变成25.950000一共占9个字节，是孤立的</span></span><br><span class="line"><span class="keyword">char</span> _test3[<span class="number">9</span>];</span><br><span class="line"><span class="built_in">memcpy</span>(_test3, _str.<span class="built_in">data</span>(), <span class="number">9</span>);<span class="comment">//_test3 = 0x15c1f8ac &quot;25.950001&quot;</span></span><br><span class="line"><span class="keyword">float</span> _test4 = <span class="built_in">atof</span>(_test3);<span class="comment">//25.950008</span></span><br><span class="line"><span class="built_in">memcpy</span>(_test3, _str.<span class="built_in">data</span>() + <span class="number">10</span>, <span class="number">9</span>);<span class="comment">//_test3 = 0x15c1f8ac &quot;15.950001&quot;</span></span><br><span class="line">_test4 = <span class="built_in">atof</span>(_test3);<span class="comment">//15.950008</span></span><br><span class="line"><span class="comment">//或者用sscanf直接把字符串转成float</span></span><br><span class="line"><span class="keyword">float</span> _test1, _test2;</span><br><span class="line"><span class="built_in">sscanf</span>(_str.<span class="built_in">data</span>(), <span class="string">&quot;%f,%f&quot;</span>, &amp;_test1, &amp;_test2);<span class="comment">//25.950008，15.950008</span></span><br><span class="line"><span class="comment">/*********************下面是真实数据那一套，不正确，作为整体拷贝************************/</span></span><br><span class="line"><span class="comment">//直接使用cpy，拷贝到float中</span></span><br><span class="line"><span class="built_in">memcpy</span>(&amp;_test2, _str.<span class="built_in">data</span>(), <span class="built_in"><span class="keyword">sizeof</span></span>(_test));<span class="comment">//_test2 = 0.000166137499</span></span><br><span class="line"><span class="comment">//下面这个是错的，因为转成字符串发送过来之后字节数就变了25.95变成25.950000一共占9个字节</span></span><br><span class="line"><span class="comment">//memcpy(&amp;_test2, _str.data() + sizeof(_test), sizeof(_test));</span></span><br></pre></td></tr></table></figure>

<p>第二种：发送真实数据</p>
<p>如果我们用memcpy函数来直接由内存转换，1234这个int，转换之后结果如下</p>
<p><img src="/2021/06/20/%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%9B%B8%E5%85%B3/81937487-440c-48ce-b348-4476c6545a7b.png" alt="img"></p>
<p>这是因为什么呢？*_itoa()<em>函数会把1234一个一个整数转换成对应的ascii码( (n % 10)+’0’ ),所以得到的string就是’1’,’2’,’3’,’4’，但是</em>memcpy(void *dest, void *src, unsigned int *count*)*是由src所指内存区域复制count个字节到dest所指内存区域，比如1234，占UINT16即两个字节，把对应字节的东西拷贝到sendbuf中，那sendbuf每个字节对应的都是对应位置的内容，如1234的二进制是10011010010 ，8位一个字节，则可以分成两个部分，分别是100和11010010，二进制100=4，而二进制11010010=210，大于127（sendbuf是有符号的），所以210-127=83，然后从-128又开始网上加，-128+83=-45，然后-45-1=-46恰好和程序中的吻合。</p>
<p>为什么要210-127+（-128）-1呢？210-127是比最大值大多少(83)，说明是从起点开始，第83个数，起点是多少，是-128，那第83个数是多少，-128+83-1=-46。</p>
<p>这样发送过去的就是真实的数据，在取的时候，直接用</p>
<p>int _test2; <em>memcpy</em>(&amp;_test2, _test1, sizeof(_test));</p>
<p>把内存整体复制到int类型的_test2变量中，_test2就是1234，不能使用字符串的那一套，因为这并不是字符串，存储的并不是ascii码，不是孤立的，拼起来啥都不是。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//发送测试</span></span><br><span class="line"><span class="keyword">float</span> _test = <span class="number">25.95</span>;</span><br><span class="line"><span class="keyword">char</span> _test1[<span class="number">10</span>];</span><br><span class="line"><span class="built_in">memset</span>(_test1, <span class="number">0</span>, <span class="number">10</span>);</span><br><span class="line"><span class="comment">//赋值给char *</span></span><br><span class="line"><span class="built_in">memcpy</span>(_test1, &amp;_test, <span class="built_in"><span class="keyword">sizeof</span></span>(_test));</span><br><span class="line">_test -= <span class="number">10</span>;</span><br><span class="line"><span class="built_in">memcpy</span>(_test1 + <span class="built_in"><span class="keyword">sizeof</span></span>(_test), &amp;_test, <span class="built_in"><span class="keyword">sizeof</span></span>(_test));</span><br><span class="line"><span class="comment">//直接使用cpy，拷贝到float中,原来占多少字节就是多少字节,作为一个整体拷贝进去</span></span><br><span class="line"><span class="keyword">float</span> _test2;</span><br><span class="line"><span class="built_in">memcpy</span>(&amp;_test2, _test1, <span class="built_in"><span class="keyword">sizeof</span></span>(_test));<span class="comment">//25.95</span></span><br><span class="line"><span class="built_in">memcpy</span>(&amp;_test2, _test1 + <span class="built_in"><span class="keyword">sizeof</span></span>(_test), <span class="built_in"><span class="keyword">sizeof</span></span>(_test));<span class="comment">//25.95</span></span><br><span class="line"><span class="comment">/*********************下面是字符串那一套，不正确************************/</span></span><br><span class="line"><span class="comment">//先拷贝在char * 里面，在转成float，每个字节是孤立的</span></span><br><span class="line"><span class="keyword">char</span> _test3[<span class="number">4</span>];</span><br><span class="line"><span class="built_in">memcpy</span>(_test3, _test1, <span class="built_in"><span class="keyword">sizeof</span></span>(_test));</span><br><span class="line"><span class="comment">//把_test3当成了存储ascii码的字符串,[0] = -102 &#x27;?&#x27;,[1] = -102 &#x27;?&#x27;，[2] = -49 &#x27;?&#x27;，[3] = 65 &#x27;A&#x27;</span></span><br><span class="line"><span class="keyword">float</span> _test4 = <span class="built_in">atof</span>(_test3);<span class="comment">//0.0000，</span></span><br><span class="line"><span class="built_in">memcpy</span>(_test3, _test1 + <span class="built_in"><span class="keyword">sizeof</span></span>(_test), <span class="built_in"><span class="keyword">sizeof</span></span>(_test));</span><br><span class="line"><span class="comment">//把_test3当成了存储ascii码的字符串,[0] = 52 &#x27;4&#x27;,[1] = 51 &#x27;3&#x27;，[2] = 127 &#x27;•&#x27;，[3] = 65 &#x27;A&#x27;</span></span><br><span class="line">_test4 = <span class="built_in">atof</span>(_test3);<span class="comment">//43.0000</span></span><br></pre></td></tr></table></figure>

<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//float转char </span></span><br><span class="line"><span class="keyword">float</span> a = <span class="number">12.54</span>;</span><br><span class="line"><span class="keyword">float</span> b = <span class="number">2.5</span>;</span><br><span class="line"><span class="keyword">char</span> *sendbuf = <span class="keyword">new</span> <span class="keyword">char</span>[<span class="number">10</span>];</span><br><span class="line"><span class="keyword">char</span> number[<span class="number">5</span>];</span><br><span class="line"><span class="built_in">sprintf</span>(number, <span class="string">&quot;%f&quot;</span>,a);</span><br><span class="line"><span class="built_in">memcpy</span>(sendbuf, &amp;number, <span class="built_in"><span class="keyword">sizeof</span></span>(number));</span><br><span class="line"><span class="built_in">memset</span>(number, <span class="number">0</span>, <span class="built_in"><span class="keyword">sizeof</span></span>(number));</span><br><span class="line"><span class="built_in">sprintf</span>(number, <span class="string">&quot;%f&quot;</span>, b);</span><br><span class="line"><span class="built_in">memcpy</span>(sendbuf + <span class="built_in"><span class="keyword">sizeof</span></span>(number), &amp;(number), <span class="built_in"><span class="keyword">sizeof</span></span>(number));</span><br></pre></td></tr></table></figure>

<h1 id="数据转换-真实值、ASCII（其实都是值）"><a href="#数据转换-真实值、ASCII（其实都是值）" class="headerlink" title="数据转换-真实值、ASCII（其实都是值）"></a>数据转换-真实值、ASCII（其实都是值）</h1><p>网络发送都是发送的内存值，只不过解析的时候按照类型来不同的解析，1234，在short里是-46 4 0 0，在字符串里是‘1’ ‘2’ ‘3’ ‘4’ ‘/0’，根据类型来解析，发送的时候，short是&amp;,字符串是.data() ,但是都发送的是内存存储的值，short是-46 4 0 0，字符串里是‘1’ ‘2’ ‘3’ ‘4’ ‘/0’，接收到之后再相应的转换memcpy。</p>
<p>原型：void* memcpy(void * dest, const void * src, unsigned int count); </p>
<p>功能：由src所指内存区域复制count个字节到dest所指内存区域。 </p>
<p>说明：src和dest所指内存区域不能重叠，函数返回指向dest的指针。 </p>
<h1 id="数组与结构体取内存值"><a href="#数组与结构体取内存值" class="headerlink" title="数组与结构体取内存值"></a>数组与结构体取内存值</h1><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">test</span>&#123;</span></span><br><span class="line">    <span class="keyword">int</span> a;</span><br><span class="line">    <span class="keyword">int</span> b;</span><br><span class="line">&#125;;</span><br><span class="line">std::vector&lt;test&gt; tes;</span><br><span class="line">test temp;</span><br><span class="line">temp.a=<span class="number">1111</span>;</span><br><span class="line">temp.b=<span class="number">2222</span>;</span><br><span class="line">tes.<span class="built_in">push_back</span>(temp);</span><br><span class="line">tes.<span class="built_in">push_back</span>(temp);</span><br><span class="line"><span class="built_in">qDebug</span>()&lt;&lt;<span class="string">&quot;&amp;=&quot;</span>&lt;&lt;&amp;tes&lt;&lt;<span class="string">&quot;  1=&quot;</span>&lt;&lt;&amp;tes[<span class="number">0</span>]&lt;&lt;<span class="string">&quot;  2=&quot;</span>&lt;&lt;&amp;tes[<span class="number">1</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">//打印出来的结果是</span></span><br><span class="line"><span class="comment">//&amp;= 0x27992ffa38   1= 0x18e04293e00   2= 0x18e04293e08</span></span><br><span class="line"><span class="comment">//从这可以看出来，首先，结构体的内存是连续的，其次，容器内的模板数据内存是连续的，但是容器的内存和模板数据的内存不连续，</span></span><br><span class="line"><span class="comment">//因此在发送网络数据时，不能对容器直接取地址然后发送，需要对容器内的数据取地址再发送：</span></span><br><span class="line"><span class="comment">//sendbuf.append(QByteArray((char*)&amp;tes[0], sizeof(test)*tes.size()));</span></span><br><span class="line"><span class="comment">//相应的,在接收端也需要如此取</span></span><br></pre></td></tr></table></figure>

<p>个人理解：<br>容器除了模板数据之外，还有其他变量，容器是类，里面包含了模板数据、对数据的描述（个数等），这些加起来的长度和模板数据本身<br>的大小不一致，不能完全取地址发送，简单点，vector里面还有容量这个成员变量，发送端容量和接收端容量不一致，导致两者字节数不匹配</p>
<p>#可变长结构体内存拷贝</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> BUF_SIZE = <span class="number">100</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">s_one</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">int</span> s_one_cnt;</span><br><span class="line">    <span class="keyword">char</span>*s_one_buf;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">s_two</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">int</span> s_two_cnt;</span><br><span class="line">    <span class="keyword">char</span> s_two_buf[<span class="number">0</span>];</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">s_three</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">int</span> s_three_cnt;</span><br><span class="line">    <span class="keyword">char</span> s_three_buf[<span class="number">1</span>];</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//赋值用</span></span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span>* tmp_buf = <span class="string">&quot;abcdefghijklmnopqrstuvwxyz&quot;</span>;</span><br><span class="line">    <span class="keyword">int</span> ntmp_buf_size = <span class="built_in">strlen</span>(tmp_buf);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//&lt;1&gt;注意s_one 与s_two的大小的不同</span></span><br><span class="line">    cout&lt;&lt; <span class="string">&quot;sizeof(s_one) = &quot;</span> &lt;&lt; <span class="built_in"><span class="keyword">sizeof</span></span>(s_one) &lt;&lt; endl; <span class="comment">//8</span></span><br><span class="line">    cout&lt;&lt; <span class="string">&quot;sizeof(s_two) = &quot;</span> &lt;&lt; <span class="built_in"><span class="keyword">sizeof</span></span>(s_two) &lt;&lt; endl; <span class="comment">//4</span></span><br><span class="line">    cout&lt;&lt; <span class="string">&quot;sizeof(s_three) = &quot;</span> &lt;&lt; <span class="built_in"><span class="keyword">sizeof</span></span>(s_three) &lt;&lt; endl;<span class="comment">//5--&gt;8结构体对齐</span></span><br><span class="line">    cout&lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//为buf分配空间</span></span><br><span class="line">    <span class="keyword">int</span> ntotal_stwo_onw= <span class="number">1</span> + ntmp_buf_size;</span><br><span class="line">    <span class="keyword">int</span> ntotal_stwo_len = <span class="built_in"><span class="keyword">sizeof</span></span>(s_two) + (<span class="number">1</span> + ntmp_buf_size) * <span class="built_in"><span class="keyword">sizeof</span></span>(<span class="keyword">char</span>);<span class="comment">//+1是因为char数组最后一位是/0</span></span><br><span class="line">    <span class="keyword">int</span> ntotal_sthree_len = <span class="built_in"><span class="keyword">sizeof</span></span>(s_three) + ntmp_buf_size * <span class="built_in"><span class="keyword">sizeof</span></span>(<span class="keyword">char</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//给s_one buf赋值</span></span><br><span class="line">    s_one*p_sone = (s_one*)<span class="built_in">malloc</span>(<span class="built_in"><span class="keyword">sizeof</span></span>(s_one));</span><br><span class="line">    <span class="built_in">memset</span>(p_sone,<span class="number">0</span>, <span class="built_in"><span class="keyword">sizeof</span></span>(s_one));</span><br><span class="line">    p_sone-&gt;s_one_buf= (<span class="keyword">char</span>*)<span class="built_in">malloc</span>(ntotal_stwo_onw);</span><br><span class="line">    <span class="built_in">memset</span>(p_sone-&gt;s_one_buf,<span class="number">0</span>, ntotal_stwo_onw);</span><br><span class="line">    <span class="built_in">memcpy</span>(p_sone-&gt;s_one_buf,tmp_buf, ntmp_buf_size);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//给s_two buf赋值</span></span><br><span class="line">    s_two*p_stwo = (s_two*)<span class="built_in">malloc</span>(ntotal_stwo_len);</span><br><span class="line">    <span class="built_in">memset</span>(p_stwo,<span class="number">0</span>, ntotal_stwo_len);</span><br><span class="line">    <span class="built_in">memcpy</span>((<span class="keyword">char</span>*)(p_stwo-&gt;s_two_buf),tmp_buf, ntmp_buf_size);  <span class="comment">//不用加偏移量，直接拷贝!</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//给s_three_buf赋值</span></span><br><span class="line">    s_three*p_sthree = (s_three*)<span class="built_in">malloc</span>(ntotal_sthree_len);</span><br><span class="line">    <span class="built_in">memset</span>(p_sthree,<span class="number">0</span>, ntotal_sthree_len);</span><br><span class="line">    <span class="built_in">memcpy</span>((<span class="keyword">char</span>*)(p_sthree-&gt;s_three_buf),tmp_buf, ntmp_buf_size);</span><br><span class="line"></span><br><span class="line">    cout&lt;&lt; <span class="string">&quot;p_sone-&gt;s_one_buf = &quot;</span> &lt;&lt; p_sone-&gt;s_one_buf&lt;&lt; endl;</span><br><span class="line">    cout&lt;&lt; <span class="string">&quot;p_stwo-&gt;s_two_buf = &quot;</span> &lt;&lt; p_stwo-&gt;s_two_buf&lt;&lt; endl;</span><br><span class="line">    cout&lt;&lt; <span class="string">&quot;p_sthree-&gt;s_three_buf = &quot;</span> &lt;&lt;p_sthree-&gt;s_three_buf &lt;&lt; endl; <span class="comment">//不用加偏移量，直接拷贝!</span></span><br><span class="line">    cout&lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//&lt;2&gt;注意s_one 与s_two释放的不同！</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="literal">NULL</span> != p_sone-&gt;s_one_buf)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">free</span>(p_sone-&gt;s_one_buf);</span><br><span class="line">        p_sone-&gt;s_one_buf= <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(<span class="literal">NULL</span> != p_sone)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">free</span>(p_sone);</span><br><span class="line">            p_sone= <span class="literal">NULL</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        cout&lt;&lt; <span class="string">&quot;free(p_sone) successed!&quot;</span> &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="literal">NULL</span> != p_stwo)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">free</span>(p_stwo);</span><br><span class="line">        p_stwo= <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">        cout&lt;&lt; <span class="string">&quot;free(p_stwo) successed!&quot;</span> &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="literal">NULL</span> != p_sthree)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">free</span>(p_sthree);</span><br><span class="line">        p_sthree= <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">        cout&lt;&lt; <span class="string">&quot;free(p_sthree) successed!&quot;</span> &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>对比结果，我们能发现：<br>&lt;1&gt; 存储大小方面：s_two的存储较s_one、s_three都要少，[0]的好处，即用指针的方式需要多开辟存储空间的。<br>&lt;2&gt; 数据连续存储方面：s_one明显数据域是单独开辟的空间，与前的nsize不在连续的存储区域，而s_two，s_three则在连续的存储空间下。<br>&lt;3&gt; 释放内存方面：显然s_one的指针的方式，需要先释放数据域部分，才能释放指向结构体的指针变量；而s_two，s_three可以直接释放。</p>
<p>总结如下：</p>
<p>结构体最后使用0或1的长度数组的原因，主要是为了方便的管理内存缓冲区，如果你直接使用指针而不使用数组，那么，你在分配内存缓冲区时，就必须分配结构体一次，然后再分配结构体内的指针一次，（而此时分配的内存已经与结构体的内存不连续了，所以要分别管理即申请和释放）。</p>
<p>而如果使用数组，那么只需要一次就可以全部分配出来，反过来，释放时也是一样，使用数组，一次释放，使用指针，得先释放结构体内的指针，再释放结构体。还不能颠倒次序。</p>
<p>其实变长结构体就是分配一段连续的的内存，减少内存的碎片化，简化内存的管理。</p>
<p>#可变长结构体网络发送</p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/yongdaimi/p/14120907.html">https://www.cnblogs.com/yongdaimi/p/14120907.html</a></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QBuffer&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QCoreApplication&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QDateTime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QFileInfo&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QImage&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QUdpSocket&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QThread&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QPainter&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;header.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QImageReader&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QTcpSocket&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">inside</span>&#123;</span></span><br><span class="line">    <span class="keyword">int</span> a;</span><br><span class="line">    <span class="keyword">int</span> b;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">test</span>&#123;</span></span><br><span class="line">    <span class="keyword">int</span> c=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">int</span> d=<span class="number">2</span>;</span><br><span class="line">    inside _inside[<span class="number">0</span>];</span><br><span class="line">&#125;;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> pack(pop)</span></span><br><span class="line">QTcpSocket *m_tcp;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="function">QCoreApplication <span class="title">a</span><span class="params">(argc, argv)</span></span>;</span><br><span class="line"></span><br><span class="line">    inside _temp[<span class="number">2</span>];</span><br><span class="line">    _temp[<span class="number">0</span>].a=<span class="number">111</span>;</span><br><span class="line">    _temp[<span class="number">0</span>].b=<span class="number">111</span>;</span><br><span class="line"></span><br><span class="line">    _temp[<span class="number">1</span>].a=<span class="number">111</span>;</span><br><span class="line">    _temp[<span class="number">1</span>].b=<span class="number">111</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> _structLength = <span class="built_in"><span class="keyword">sizeof</span></span>(test) + <span class="number">2</span> * <span class="built_in"><span class="keyword">sizeof</span></span>(inside);</span><br><span class="line"></span><br><span class="line">    test* p_test = (test*)<span class="built_in">malloc</span>(_structLength);</span><br><span class="line">    <span class="built_in">memset</span>(p_test,<span class="number">0</span>, _structLength);</span><br><span class="line">    p_test-&gt;c=<span class="number">1</span>;</span><br><span class="line">    p_test-&gt;d=<span class="number">2</span>;</span><br><span class="line">    <span class="built_in">memcpy</span>((<span class="keyword">char</span>*)(p_test-&gt;_inside),_temp, <span class="number">2</span> * <span class="built_in"><span class="keyword">sizeof</span></span> (inside));</span><br><span class="line">    <span class="built_in">qDebug</span>()&lt;&lt;<span class="string">&quot;sizeof(inside)=&quot;</span>&lt;&lt;<span class="built_in"><span class="keyword">sizeof</span></span> (inside)&lt;&lt;<span class="string">&quot;,sizeof(test)=&quot;</span>&lt;&lt;<span class="built_in"><span class="keyword">sizeof</span></span> (test)&lt;&lt;<span class="string">&quot;,_structLength=&quot;</span>&lt;&lt;_structLength</span><br><span class="line">           &lt;&lt;<span class="string">&quot;,p_test.c=&quot;</span>&lt;&lt;p_test-&gt;c&lt;&lt;<span class="string">&quot;,p_test.d=&quot;</span>&lt;&lt;p_test-&gt;d</span><br><span class="line">          &lt;&lt;<span class="string">&quot;,p_test._inside[0].a=&quot;</span>&lt;&lt;p_test-&gt;_inside[<span class="number">0</span>].a&lt;&lt;<span class="string">&quot;,p_test._inside[0].b=&quot;</span>&lt;&lt;p_test-&gt;_inside[<span class="number">0</span>].b</span><br><span class="line">         &lt;&lt;<span class="string">&quot;,p_test._inside[1].a=&quot;</span>&lt;&lt;p_test-&gt;_inside[<span class="number">1</span>].a&lt;&lt;<span class="string">&quot;,p_test._inside[1].b=&quot;</span>&lt;&lt;p_test-&gt;_inside[<span class="number">1</span>].b;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    m_tcp = <span class="keyword">new</span> QTcpSocket;</span><br><span class="line">    m_tcp-&gt;<span class="built_in">connectToHost</span>(<span class="built_in">QHostAddress</span>(<span class="string">&quot;10.16.52.102&quot;</span>),<span class="number">8010</span>);<span class="comment">//(&quot;159.226.20.181&quot;),9999);//</span></span><br><span class="line">    m_tcp-&gt;<span class="built_in">waitForConnected</span>();</span><br><span class="line"></span><br><span class="line">    QByteArray sendBuf=<span class="built_in">QByteArray</span>((<span class="keyword">char</span>*)p_test, _structLength);</span><br><span class="line">    m_tcp-&gt;<span class="built_in">write</span>(sendBuf);</span><br><span class="line">    <span class="built_in">system</span>(<span class="string">&quot;pause&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> a.<span class="built_in">exec</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> RECEIVE_H</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> RECEIVE_H</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QObject&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QImage&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QUdpSocket&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QTcpSocket&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QTcpServer&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QDateTime&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> REAL32 float</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Receive</span>:</span><span class="keyword">public</span> QObject</span><br><span class="line">&#123;</span><br><span class="line">    Q_OBJECT</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Receive</span>();</span><br><span class="line"></span><br><span class="line">    QUdpSocket* m_reciver;</span><br><span class="line"></span><br><span class="line">    QTcpServer *m_tcpServer =<span class="literal">NULL</span>;<span class="comment">//监听套接字</span></span><br><span class="line">    QTcpSocket *m_tcpSocket;<span class="comment">//通信套接字</span></span><br><span class="line"></span><br><span class="line">    QByteArray m_buf;</span><br><span class="line">    QByteArray m_Msgdata;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> slots:</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">slot_connecting</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">slot_TCPgetMes</span><span class="params">()</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">// RECEIVE_H</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;Receive.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QBuffer&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QDir&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QFile&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QImageReader&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">inside</span>&#123;</span></span><br><span class="line">    <span class="keyword">int</span> a;</span><br><span class="line">    <span class="keyword">int</span> b;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">test</span>&#123;</span></span><br><span class="line">    <span class="keyword">int</span> c;</span><br><span class="line">    <span class="keyword">int</span> d;</span><br><span class="line">    inside _inside[<span class="number">0</span>];</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Receive::<span class="built_in">Receive</span>()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//监听套接字</span></span><br><span class="line">    m_tcpServer = <span class="keyword">new</span> <span class="built_in">QTcpServer</span>(<span class="keyword">this</span>);</span><br><span class="line">    <span class="comment">//监听</span></span><br><span class="line">    m_tcpServer-&gt;<span class="built_in">listen</span>(<span class="built_in">QHostAddress</span>(<span class="string">&quot;10.16.52.102&quot;</span>),<span class="number">8010</span>);<span class="comment">//(&quot;172.18.12.10&quot;),4391);//(&quot;172.18.12.10&quot;),4391);</span></span><br><span class="line">    <span class="comment">//如果客户端成功和服务器连接</span></span><br><span class="line">    <span class="comment">//tcpServer 会自动触发   newConnection()</span></span><br><span class="line">    <span class="built_in">connect</span>(m_tcpServer,<span class="built_in">SIGNAL</span>(<span class="built_in">newConnection</span>()),<span class="keyword">this</span>,<span class="built_in">SLOT</span>(<span class="built_in">slot_connecting</span>()));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Receive::slot_connecting</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//取出建立好连接的套接字</span></span><br><span class="line">    m_tcpSocket = m_tcpServer-&gt;<span class="built_in">nextPendingConnection</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//获取对方的ip和端口</span></span><br><span class="line">    QString ip = m_tcpSocket-&gt;<span class="built_in">peerAddress</span>().<span class="built_in">toString</span>();</span><br><span class="line">    quint16 port = m_tcpSocket-&gt;<span class="built_in">peerPort</span>();</span><br><span class="line">    QString str = QString::<span class="built_in">fromLocal8Bit</span>(<span class="string">&quot;[%1 : %2] 成功连接&quot;</span>).<span class="built_in">arg</span>(ip).<span class="built_in">arg</span>(port);</span><br><span class="line">    <span class="built_in">qDebug</span>()&lt;&lt;<span class="string">&quot;Connected OK.&quot;</span>&lt;&lt;str;</span><br><span class="line">    <span class="built_in">connect</span>(m_tcpSocket,<span class="built_in">SIGNAL</span>(<span class="built_in">readyRead</span>()),<span class="keyword">this</span>,<span class="built_in">SLOT</span>(<span class="built_in">slot_TCPgetMes</span>()));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Receive::slot_TCPgetMes</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    QByteArray value= m_tcpSocket-&gt;<span class="built_in">readAll</span>();<span class="comment">//分包</span></span><br><span class="line"></span><br><span class="line">    inside _temp[<span class="number">2</span>];</span><br><span class="line">    <span class="keyword">int</span> _structLength = <span class="built_in"><span class="keyword">sizeof</span></span>(test) + <span class="number">2</span> * <span class="built_in"><span class="keyword">sizeof</span></span>(inside);</span><br><span class="line"></span><br><span class="line">    test* p_test = (test*)<span class="built_in">malloc</span>(_structLength);</span><br><span class="line">    <span class="built_in">memset</span>(p_test,<span class="number">0</span>, _structLength);</span><br><span class="line">    <span class="built_in">memcpy</span>((<span class="keyword">char</span>*)(p_test),value, value.<span class="built_in">size</span>());</span><br><span class="line">    <span class="built_in">qDebug</span>()&lt;&lt;<span class="string">&quot;sizeof(inside)=&quot;</span>&lt;&lt;<span class="built_in"><span class="keyword">sizeof</span></span> (inside)&lt;&lt;<span class="string">&quot;,sizeof(test)=&quot;</span>&lt;&lt;<span class="built_in"><span class="keyword">sizeof</span></span> (test)&lt;&lt;<span class="string">&quot;,_structLength=&quot;</span>&lt;&lt;_structLength</span><br><span class="line">           &lt;&lt;<span class="string">&quot;,p_test.c=&quot;</span>&lt;&lt;p_test-&gt;c&lt;&lt;<span class="string">&quot;,p_test.d=&quot;</span>&lt;&lt;p_test-&gt;d</span><br><span class="line">          &lt;&lt;<span class="string">&quot;,p_test._inside[0].a=&quot;</span>&lt;&lt;p_test-&gt;_inside[<span class="number">0</span>].a&lt;&lt;<span class="string">&quot;,p_test._inside[0].b=&quot;</span>&lt;&lt;p_test-&gt;_inside[<span class="number">0</span>].b</span><br><span class="line">         &lt;&lt;<span class="string">&quot;,p_test._inside[1].a=&quot;</span>&lt;&lt;p_test-&gt;_inside[<span class="number">1</span>].a&lt;&lt;<span class="string">&quot;,p_test._inside[1].b=&quot;</span>&lt;&lt;p_test-&gt;_inside[<span class="number">1</span>].b;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">system</span>(<span class="string">&quot;pause&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="sizeof-、strlen-、str-length"><a href="#sizeof-、strlen-、str-length" class="headerlink" title="sizeof() 、strlen()、str.length()"></a>sizeof() 、strlen()、str.length()</h1><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">(C/C++ <span class="built_in">strlen</span>(str)和str.<span class="built_in">length</span>()和str.<span class="built_in">size</span>()都可以求字符串长度。</span><br><span class="line"></span><br><span class="line">其中str.<span class="built_in">length</span>()和str.<span class="built_in">size</span>()是用于求string类对象的成员函数</span><br><span class="line"></span><br><span class="line"><span class="built_in">strlen</span>(str)是用于求字符数组的长度，其参数是<span class="keyword">char</span>*。)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	第一种：<span class="built_in">strlen</span>(<span class="keyword">char</span>*)函数求的是字符串的实际长度，它求得方法是从开始到遇到第一个<span class="string">&#x27;\0&#x27;</span>,如果你只定义没有给它赋初值，这个结果是不定的，它会从aa首地址一直找下去，直到遇到<span class="string">&#x27;\0&#x27;</span>停止。</span><br><span class="line">	第二种：<span class="built_in"><span class="keyword">sizeof</span></span>(),求所占总空间的字节数。</span><br><span class="line">这里例如  </span><br><span class="line"><span class="keyword">char</span>[] a=&#123;<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;b&#x27;</span>,<span class="string">&#x27;c&#x27;</span>&#125;;</span><br><span class="line"><span class="built_in"><span class="keyword">sizeof</span></span>(a)的值应该为<span class="number">3</span>。</span><br><span class="line"><span class="keyword">char</span>[] b=&#123;<span class="string">&quot;abc&quot;</span>&#125;;</span><br><span class="line"><span class="built_in"><span class="keyword">sizeof</span></span>(b)的值应该是<span class="number">4</span>。</span><br><span class="line">若string str=&#123;<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;b&#x27;</span>,<span class="string">&#x27;c&#x27;</span>,<span class="string">&#x27;\0&#x27;</span>,<span class="string">&#x27;X&#x27;</span>&#125;;</span><br><span class="line">那么<span class="built_in"><span class="keyword">sizeof</span></span>(str)为<span class="number">5</span>，<span class="built_in">strlen</span>(str)为<span class="number">3</span>。</span><br></pre></td></tr></table></figure>

<h1 id="Qt显示中文"><a href="#Qt显示中文" class="headerlink" title="Qt显示中文"></a>Qt显示中文</h1><h2 id="Windows-接收、发送"><a href="#Windows-接收、发送" class="headerlink" title="Windows 接收、发送"></a>Windows 接收、发送</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">文件编码用system</span><br><span class="line">QString str;</span><br><span class="line">str.<span class="built_in">append</span>(QString::<span class="built_in">fromLocal8Bit</span>(<span class="string">&quot;摄像头类型:S:&quot;</span>));</span><br><span class="line"><span class="function">emit <span class="title">signal_sendStatus</span><span class="params">(str.toLocal8Bit())</span></span>;</span><br></pre></td></tr></table></figure>

<h2 id="Linux-发送"><a href="#Linux-发送" class="headerlink" title="Linux 发送"></a>Linux 发送</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">文件编码用UTF<span class="number">-8</span></span><br><span class="line">QTextCodec *code= QTextCodec::<span class="built_in">codecForName</span>(<span class="string">&quot;GBK&quot;</span>);</span><br><span class="line">QString strtest = <span class="string">&quot;你好Test&quot;</span>;</span><br><span class="line">QByteArray bytest = code-&gt;<span class="built_in">fromUnicode</span>( strtest );</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//接收未测试</span></span><br><span class="line">QTextCodec *tc =QTextCodec::<span class="built_in">codecForName</span>(<span class="string">&quot;GBK&quot;</span>);</span><br><span class="line">QByteArray ba = file.<span class="built_in">readAll</span>();</span><br><span class="line">QString str =tc-&gt;<span class="built_in">toUnicode</span>(ba);</span><br></pre></td></tr></table></figure>

<h1 id="字符串转16进制"><a href="#字符串转16进制" class="headerlink" title="字符串转16进制"></a>字符串转16进制</h1><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">string_to_hex</span><span class="params">(QString hex,QByteArray &amp;qbyte)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    hex=hex.<span class="built_in">trimmed</span>();</span><br><span class="line"> </span><br><span class="line">    QStringList sl=hex.<span class="built_in">split</span>(<span class="string">&quot; &quot;</span>);</span><br><span class="line">    foreach(QString s,sl)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(!s.<span class="built_in">isEmpty</span>())</span><br><span class="line">            qbyte.<span class="built_in">append</span>((<span class="keyword">char</span>)s.<span class="built_in">toInt</span>(<span class="number">0</span>,<span class="number">16</span>)&amp;<span class="number">0xFF</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//用来输出16进制</span></span><br><span class="line">QString str;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">5</span>;i&lt;_str.<span class="built_in">size</span>();i++) &#123;</span><br><span class="line">    str.<span class="built_in">append</span>(<span class="built_in">QString</span>(<span class="string">&quot;%1&quot;</span>).<span class="built_in">arg</span>((<span class="keyword">unsigned</span> <span class="keyword">char</span>)_str[i],<span class="number">2</span>,<span class="number">16</span>,<span class="built_in">QLatin1Char</span>(<span class="string">&#x27;0&#x27;</span>)).<span class="built_in">toUpper</span>());</span><br><span class="line">    str.<span class="built_in">append</span>(<span class="string">&quot; &quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="QByteArray-转换为16进制字符串QString"><a href="#QByteArray-转换为16进制字符串QString" class="headerlink" title="QByteArray 转换为16进制字符串QString"></a>QByteArray 转换为16进制字符串QString</h1><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">QString <span class="title">MainWindow::ByteArrayToHexString</span><span class="params">(QByteArray data)</span></span>&#123;</span><br><span class="line">    <span class="function">QString <span class="title">ret</span><span class="params">(data.toHex().toUpper())</span></span>;</span><br><span class="line">    <span class="keyword">int</span> len = ret.<span class="built_in">length</span>()/<span class="number">2</span>;</span><br><span class="line">    <span class="built_in">qDebug</span>()&lt;&lt;len;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;len;i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">qDebug</span>()&lt;&lt;i;</span><br><span class="line">        ret.<span class="built_in">insert</span>(<span class="number">2</span>*i+i<span class="number">-1</span>,<span class="string">&quot; &quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="16进制字符串QString转换QByteArray"><a href="#16进制字符串QString转换QByteArray" class="headerlink" title="16进制字符串QString转换QByteArray"></a><a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=16%E8%BF%9B%E5%88%B6&spm=1001.2101.3001.7020">16进制</a>字符串QString转换QByteArray</h1><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment"> * @breif 将16进制字符串转换为对应的字节序列</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function">QByteArray <span class="title">HexStringToByteArray</span><span class="params">(QString HexString)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">bool</span> ok;</span><br><span class="line">    QByteArray ret;</span><br><span class="line">    HexString = HexString.<span class="built_in">trimmed</span>();</span><br><span class="line">    HexString = HexString.<span class="built_in">simplified</span>();</span><br><span class="line">    QStringList sl = HexString.<span class="built_in">split</span>(<span class="string">&quot; &quot;</span>);</span><br><span class="line"></span><br><span class="line">    foreach (QString s, sl) &#123;</span><br><span class="line">        <span class="keyword">if</span>(!s.<span class="built_in">isEmpty</span>())</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">char</span> c = s.<span class="built_in">toInt</span>(&amp;ok,<span class="number">16</span>)&amp;<span class="number">0xFF</span>;</span><br><span class="line">            <span class="keyword">if</span>(ok)&#123;</span><br><span class="line">                ret.<span class="built_in">append</span>(c);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="built_in">qDebug</span>()&lt;&lt;<span class="string">&quot;非法的16进制字符：&quot;</span>&lt;&lt;s;</span><br><span class="line">                QMessageBox::<span class="built_in">warning</span>(<span class="number">0</span>,<span class="built_in">tr</span>(<span class="string">&quot;错误：&quot;</span>),<span class="built_in">QString</span>(<span class="string">&quot;非法的16进制字符: \&quot;%1\&quot;&quot;</span>).<span class="built_in">arg</span>(s));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">qDebug</span>()&lt;&lt;ret;</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="IO输出截断"><a href="#IO输出截断" class="headerlink" title="IO输出截断"></a>IO输出截断</h1><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**************************************</span></span><br><span class="line"><span class="comment">* index： 0    1    2    3</span></span><br><span class="line"><span class="comment">* —————————————————————————</span></span><br><span class="line"><span class="comment">* temp: 0x64 0x00 0x64 0x00</span></span><br><span class="line"><span class="comment">*IO输出时，只要中间有\0,后续输出均会被截断,如上，会在index为1的地方截断，在下面去Debug的地方，-2-后面就没有了</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">***************************************/</span></span><br><span class="line"><span class="built_in">qDebug</span>()&lt;&lt;<span class="string">&quot;output:&quot;</span>&lt;&lt;<span class="string">&quot;-1-&quot;</span>&lt;&lt;temp[<span class="number">0</span>]&lt;&lt;<span class="string">&quot;-2-&quot;</span>&lt;&lt;temp[<span class="number">1</span>]&lt;&lt;<span class="string">&quot;-3-&quot;</span>&lt;&lt;temp[<span class="number">2</span>]&lt;&lt;<span class="string">&quot;-4-&quot;</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>字符串碰到\0就会终止输出，不光是整个字符串，连续输出时也会如此！！！</p>
<p><img src="/2021/06/20/%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%9B%B8%E5%85%B3/image-20231218182757834.png" alt="image-20231218182757834"></p>
<p>想要避免这个问题，把输出的字符串转换成非字符形式即可！</p>
<p><img src="/2021/06/20/%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%9B%B8%E5%85%B3/image-20231218182739433.png" alt="image-20231218182739433"></p>
<h1 id="x-0x区别"><a href="#x-0x区别" class="headerlink" title="\x,0x区别"></a>\x,0x区别</h1><ul>
<li><code>0x</code> 用于表示整数值的十六进制形式，通常用于整数或指针等数据类型。</li>
<li><code>\x</code> 用于表示字符的十六进制值，通常用于字符串或字符常量中。</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">- <span class="number">0</span>x 表示整型数值（十六进制）。</span><br><span class="line">	 <span class="number">0x41</span> = <span class="number">65</span>  </span><br><span class="line">	 <span class="number">0</span>o41 = <span class="number">33</span> </span><br><span class="line">	 <span class="number">0b101</span> = <span class="number">5</span></span><br><span class="line">-<span class="string">&#x27;\x&#x27;</span> 表示字符串表达（带引号）</span><br><span class="line">	<span class="string">&#x27;\x41&#x27;</span> 表示 <span class="string">&#x27;A&#x27;</span></span><br><span class="line">	<span class="string">&#x27;\x42&#x27;</span> 表示 <span class="string">&#x27;B&#x27;</span></span><br><span class="line">- \ 表示转义</span><br></pre></td></tr></table></figure>



<p>0x 表示法<br>0x 表示法是C语言中用于表示十六进制数字的标准表示方法。它的形式是一个前缀 0x，后跟一个十六进制数字序列。这个前缀告诉编译器，后面的数字应该被解释为十六进制。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> hexValue = <span class="number">0x1A</span>;</span><br><span class="line"><span class="comment">// 十六进制数值 0x1A 表示十进制数值 26</span></span><br></pre></td></tr></table></figure>

<p>在上面的示例中，0x1A 表示一个十六进制数，它等于十进制数值 26。</p>
<p>\x 转义序列<br>\x 转义序列是用于表示字符的十六进制值的方法。它的形式是 \x 后跟两个十六进制数字，用于表示一个字符。这通常用于字符串中，以表示包含特殊字符的字符序列。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">char</span> specialChar = <span class="string">&#x27;\x0A&#x27;</span>;</span><br><span class="line"><span class="comment">// 表示换行字符</span></span><br></pre></td></tr></table></figure>

<p>在上面的示例中，\x0A 表示一个字符，它是ASCII码中的换行字符。</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">Smt</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://zwlbird.github.io/2021/06/20/%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%9B%B8%E5%85%B3/">https://zwlbird.github.io/2021/06/20/%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%9B%B8%E5%85%B3/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://zwlbird.github.io" target="_blank">.oOo.</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Qt/">Qt</a><a class="post-meta__tags" href="/tags/C/">C++</a></div><div class="post_share"><div class="social-share" data-image="https://i.loli.net/2021/06/27/W8xTBGA2O7JhRHl.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2021/06/20/%E5%85%B6%E4%BB%96/"><img class="prev-cover" src="https://i.loli.net/2021/06/27/muMz2oUV3hWjZbE.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">其他</div></div></a></div><div class="next-post pull-right"><a href="/2021/06/20/%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C/"><img class="next-cover" src="https://i.loli.net/2021/06/27/oW4MJr2aCzHYjZG.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">文件操作</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span> 相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2022/04/03/Hexo/" title="Hexo"><img class="cover" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-04-03</div><div class="title">Hexo</div></div></a></div><div><a href="/2021/06/27/C/" title="C++"><img class="cover" src="https://s2.loli.net/2023/12/12/cYpI451Z9oJwFqQ.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-06-27</div><div class="title">C++</div></div></a></div><div><a href="/2021/06/27/函数积累/" title="函数积累"><img class="cover" src="https://s2.loli.net/2023/12/12/dkLQxaftyKTzXoR.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-06-27</div><div class="title">函数积累</div></div></a></div><div><a href="/2021/06/20/头文件/" title="头文件"><img class="cover" src="https://i.loli.net/2021/06/27/bhoY29lQPvSAr6z.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-06-20</div><div class="title">头文件</div></div></a></div><div><a href="/2021/08/11/数据结构/" title="数据结构"><img class="cover" src="https://s2.loli.net/2023/12/12/9iokGWsR2Lrux78.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-08-11</div><div class="title">数据结构</div></div></a></div><div><a href="/2021/06/20/文件操作/" title="文件操作"><img class="cover" src="https://i.loli.net/2021/06/27/oW4MJr2aCzHYjZG.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-06-20</div><div class="title">文件操作</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-info-avatar is-center"><img class="avatar-img" src="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-info__name">Smt</div><div class="author-info__description">哇咔咔</div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">26</div></a></div><div class="card-info-data-item is-center"><a href="/tags/"><div class="headline">标签</div><div class="length-num">6</div></a></div><div class="card-info-data-item is-center"><a href="/categories/"><div class="headline">分类</div><div class="length-num">14</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/zwlbird/zwlbird.github.io" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:zwl931025@qq.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>公告</span></div><div class="announcement_content">This is my Blog This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%9F%A5%E6%89%BE"><span class="toc-number">1.</span> <span class="toc-text">字符串查找</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#find"><span class="toc-number">1.1.</span> <span class="toc-text">find</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#find-first-of"><span class="toc-number">1.2.</span> <span class="toc-text">find_first_of</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#find-last-of"><span class="toc-number">1.3.</span> <span class="toc-text">find_last_of</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%88%86%E5%89%B2"><span class="toc-number">2.</span> <span class="toc-text">字符串分割</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#substr"><span class="toc-number">2.1.</span> <span class="toc-text">substr</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#strtok"><span class="toc-number">2.2.</span> <span class="toc-text">strtok()</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#C-%E5%AE%BD%E5%AD%97%E7%AC%A6%E5%A4%84%E7%90%86%E5%87%BD%E6%95%B0-%E4%B8%8E-%E6%99%AE%E9%80%9A%E5%87%BD%E6%95%B0-%E5%AF%B9%E7%85%A7%E8%A1%A8"><span class="toc-number">3.</span> <span class="toc-text">C++宽字符处理函数 与 普通函数 对照表</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AE%BD%E5%AD%97%E7%AC%A6"><span class="toc-number">4.</span> <span class="toc-text">宽字符</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BC%9A%E6%98%AF%E8%B4%9F%E6%95%B0"><span class="toc-number">4.1.</span> <span class="toc-text">为什么会是负数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B0%86%E6%99%AE%E9%80%9A%E5%AD%97%E7%AC%A6%E4%B8%B2%E8%BD%AC%E5%8C%96%E6%88%90%E5%AE%BD%E5%AD%97%E7%AC%A6%EF%BC%9A"><span class="toc-number">4.2.</span> <span class="toc-text">将普通字符串转化成宽字符：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B0%86%E5%AE%BD%E5%AD%97%E7%AC%A6%E8%BD%AC%E5%8C%96%E6%88%90%E6%99%AE%E9%80%9A%E5%AD%97%E7%AC%A6%EF%BC%9A"><span class="toc-number">4.3.</span> <span class="toc-text">将宽字符转化成普通字符：</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%98%BE%E7%A4%BAascii%E7%A0%81%E4%B8%BA%E8%B4%9F%E6%95%B0"><span class="toc-number">5.</span> <span class="toc-text">显示ascii码为负数??</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#swscanf-s"><span class="toc-number">6.</span> <span class="toc-text">swscanf_s</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#strncpy-s"><span class="toc-number">7.</span> <span class="toc-text">strncpy_s</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#sscanf-sprintf"><span class="toc-number">8.</span> <span class="toc-text">sscanf  sprintf</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E8%BD%AC%E6%8D%A2-%E7%9C%9F%E5%AE%9E%E5%80%BC%E3%80%81ASCII%EF%BC%88%E7%90%86%E8%A7%A3%E7%9A%84%E4%B8%8D%E5%AF%B9%EF%BC%89"><span class="toc-number">9.</span> <span class="toc-text">数据转换-真实值、ASCII（理解的不对）</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E8%BD%AC%E6%8D%A2-%E7%9C%9F%E5%AE%9E%E5%80%BC%E3%80%81ASCII%EF%BC%88%E5%85%B6%E5%AE%9E%E9%83%BD%E6%98%AF%E5%80%BC%EF%BC%89"><span class="toc-number">10.</span> <span class="toc-text">数据转换-真实值、ASCII（其实都是值）</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%95%B0%E7%BB%84%E4%B8%8E%E7%BB%93%E6%9E%84%E4%BD%93%E5%8F%96%E5%86%85%E5%AD%98%E5%80%BC"><span class="toc-number">11.</span> <span class="toc-text">数组与结构体取内存值</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#sizeof-%E3%80%81strlen-%E3%80%81str-length"><span class="toc-number">12.</span> <span class="toc-text">sizeof() 、strlen()、str.length()</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Qt%E6%98%BE%E7%A4%BA%E4%B8%AD%E6%96%87"><span class="toc-number">13.</span> <span class="toc-text">Qt显示中文</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Windows-%E6%8E%A5%E6%94%B6%E3%80%81%E5%8F%91%E9%80%81"><span class="toc-number">13.1.</span> <span class="toc-text">Windows 接收、发送</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Linux-%E5%8F%91%E9%80%81"><span class="toc-number">13.2.</span> <span class="toc-text">Linux 发送</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E8%BD%AC16%E8%BF%9B%E5%88%B6"><span class="toc-number">14.</span> <span class="toc-text">字符串转16进制</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#QByteArray-%E8%BD%AC%E6%8D%A2%E4%B8%BA16%E8%BF%9B%E5%88%B6%E5%AD%97%E7%AC%A6%E4%B8%B2QString"><span class="toc-number">15.</span> <span class="toc-text">QByteArray 转换为16进制字符串QString</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#16%E8%BF%9B%E5%88%B6%E5%AD%97%E7%AC%A6%E4%B8%B2QString%E8%BD%AC%E6%8D%A2QByteArray"><span class="toc-number">16.</span> <span class="toc-text">16进制字符串QString转换QByteArray</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#IO%E8%BE%93%E5%87%BA%E6%88%AA%E6%96%AD"><span class="toc-number">17.</span> <span class="toc-text">IO输出截断</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#x-0x%E5%8C%BA%E5%88%AB"><span class="toc-number">18.</span> <span class="toc-text">\x,0x区别</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2022/04/03/Hexo/" title="Hexo"><img src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Hexo"/></a><div class="content"><a class="title" href="/2022/04/03/Hexo/" title="Hexo">Hexo</a><time datetime="2022-04-02T16:33:52.000Z" title="发表于 2022-04-03 00:33:52">2022-04-03</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2021/10/31/Android/" title="Android"><img src="https://s2.loli.net/2023/12/12/gfXKlqmwMWzPxH7.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Android"/></a><div class="content"><a class="title" href="/2021/10/31/Android/" title="Android">Android</a><time datetime="2021-10-31T14:03:21.000Z" title="发表于 2021-10-31 22:03:21">2021-10-31</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2021/10/19/OpenGL-highlevel/" title="OpenGL-highlevel"><img src="https://s2.loli.net/2023/12/12/zb5QarqSYDHWZs6.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="OpenGL-highlevel"/></a><div class="content"><a class="title" href="/2021/10/19/OpenGL-highlevel/" title="OpenGL-highlevel">OpenGL-highlevel</a><time datetime="2021-10-19T13:35:33.000Z" title="发表于 2021-10-19 21:35:33">2021-10-19</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2021/10/17/OpenGL-light/" title="OpenGL-light"><img src="https://s2.loli.net/2023/12/12/Dlf5uYb78R1Firw.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="OpenGL-light"/></a><div class="content"><a class="title" href="/2021/10/17/OpenGL-light/" title="OpenGL-light">OpenGL-light</a><time datetime="2021-10-17T14:09:58.000Z" title="发表于 2021-10-17 22:09:58">2021-10-17</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2021/09/21/OpenGL-3D/" title="OpenGL_3D"><img src="https://s2.loli.net/2023/12/12/EZS5QGm23HLgvW4.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="OpenGL_3D"/></a><div class="content"><a class="title" href="/2021/09/21/OpenGL-3D/" title="OpenGL_3D">OpenGL_3D</a><time datetime="2021-09-21T07:31:53.000Z" title="发表于 2021-09-21 15:31:53">2021-09-21</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('https://i.loli.net/2021/06/27/W8xTBGA2O7JhRHl.jpg')"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2024 By Smt</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="font-plus" type="button" title="放大字体"><i class="fas fa-plus"></i></button><button id="font-minus" type="button" title="缩小字体"><i class="fas fa-minus"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script src="/js/search/local-search.js"></script><script>var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',preloader.endLoading())</script><div class="js-pjax"><script>function loadValine () {
  function initValine () {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: 'RrMFpOdr0spfIDfRdBukvyf7-gzGzoHsz',
      appKey: 'nipjeGzTyw5yvNk2SgU5KmUQ',
      placeholder: 'Please leave your footprints',
      avatar: 'monsterid',
      meta: 'nick,mail,link'.split(','),
      pageSize: '10',
      lang: 'zh-CN',
      recordIP: false,
      serverURLs: '',
      emojiCDN: '',
      emojiMaps: "",
      enableQQ: false,
      path: window.location.pathname,
      requiredFields: ["nick,mail"],
      visitor: false
    }, null))
  }

  if (typeof Valine === 'function') initValine() 
  else getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js').then(initValine)
}

if ('Valine' === 'Valine' || !false) {
  if (false) btf.loadComment(document.getElementById('vcomment'),loadValine)
  else setTimeout(loadValine, 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script></div><script src="//lib.baomitu.com/jquery/3.3.1/jquery.min.js"></script><script src="https://myhkw.cn/api/player/162393526192" id="myhk" key="162393526192" m="1"></script><script defer="defer" id="fluttering_ribbon" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-fluttering-ribbon.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/click-heart.min.js" async="async" mobile="false"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/gh/metowolf/MetingJS@1.2/dist/Meting.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>